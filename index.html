<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 15px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
        }

        .sidebar-header h2 {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 10px;
        }

        .add-json-btn {
            width: 100%;
            padding: 10px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .add-json-btn:hover {
            background: #1177bb;
        }

        .json-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .json-item {
            padding: 12px;
            margin-bottom: 5px;
            background: #2d2d30;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .json-item:hover {
            background: #37373d;
        }

        .json-item.active {
            background: #094771;
            border-left: 3px solid #0e639c;
        }

        .json-item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            padding: 4px 8px;
            background: #c74440;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .json-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: #e51400;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .toolbar {
            padding: 15px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
            margin-right: auto;
        }

        .view-btn {
            padding: 8px 15px;
            background: #3e3e42;
            color: #d4d4d4;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .view-btn:hover {
            background: #505050;
        }

        .view-btn.active {
            background: #0e639c;
        }

        .toolbar button {
            padding: 8px 15px;
            background: #3e3e42;
            color: #d4d4d4;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .toolbar button:hover {
            background: #505050;
        }

        .viewer-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .json-viewer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: auto;
            padding: 20px;
        }

        .mindmap-viewer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            display: none;
        }

        .mindmap-viewer.active {
            display: block;
        }

        .json-viewer.hidden {
            display: none;
        }

        #mindmapCanvas {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        #mindmapCanvas:active {
            cursor: grabbing;
        }

        #mindmapCanvas.node-dragging {
            cursor: move;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #888;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .tree-node {
            margin-left: 20px;
        }

        .tree-item {
            display: flex;
            align-items: flex-start;
            margin: 4px 0;
            line-height: 1.6;
        }

        .toggle {
            width: 18px;
            height: 18px;
            cursor: pointer;
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #888;
            margin-right: 5px;
            flex-shrink: 0;
        }

        .toggle:hover {
            color: #d4d4d4;
        }

        .key {
            color: #9cdcfe;
            margin-right: 5px;
        }

        .string {
            color: #ce9178;
        }

        .number {
            color: #b5cea8;
        }

        .boolean {
            color: #569cd6;
        }

        .null {
            color: #569cd6;
        }

        .bracket {
            color: #d4d4d4;
        }

        .collapsed>.tree-node {
            display: none;
        }

        input[type="file"] {
            display: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #2d2d30;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: auto;
        }

        .modal-content h3 {
            margin-bottom: 15px;
            color: #d4d4d4;
        }

        .modal-content textarea {
            width: 100%;
            min-height: 300px;
            background: #1e1e1e;
            color: #d4d4d4;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #0e639c;
            color: white;
        }

        .btn-primary:hover {
            background: #1177bb;
        }

        .btn-secondary {
            background: #3e3e42;
            color: #d4d4d4;
        }

        .btn-secondary:hover {
            background: #505050;
        }

        .mindmap-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 10;
        }

        .mindmap-controls button {
            padding: 8px 12px;
            background: #2d2d30;
            color: #d4d4d4;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .mindmap-controls button:hover {
            background: #3e3e42;
        }

        .mindmap-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(45, 45, 48, 0.9);
            padding: 10px 15px;
            border-radius: 4px;
            font-size: 12px;
            color: #888;
        }

        .creator-viewer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: auto;
            padding: 30px;
            display: none;
            background: #1e1e1e;
        }

        .creator-viewer.active {
            display: block;
        }

        .creator-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .creator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .creator-header h2 {
            color: #d4d4d4;
            font-size: 28px;
        }

        .creator-actions {
            display: flex;
            gap: 10px;
        }

        .creator-actions button {
            padding: 10px 20px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .creator-actions button:hover {
            background: #1177bb;
        }

        .creator-actions button.secondary {
            background: #3e3e42;
        }

        .creator-actions button.secondary:hover {
            background: #505050;
        }

        .json-builder {
            background: #252526;
            border-radius: 8px;
            padding: 25px;
            min-height: 400px;
        }

        .field-item {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .field-item.nested {
            margin-left: 40px;
            border-left: 3px solid #0e639c;
        }

        .field-key {
            flex: 0 0 200px;
        }

        .field-key input {
            width: 100%;
            background: #1e1e1e;
            color: #9cdcfe;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
        }

        .field-key input:focus {
            outline: none;
            border-color: #0e639c;
        }

        .field-type {
            flex: 0 0 120px;
        }

        .field-type select {
            width: 100%;
            background: #1e1e1e;
            color: #d4d4d4;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
        }

        .field-type select:focus {
            outline: none;
            border-color: #0e639c;
        }

        .field-value {
            flex: 1;
        }

        .field-value input,
        .field-value textarea {
            width: 100%;
            background: #1e1e1e;
            color: #ce9178;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
        }

        .field-value textarea {
            min-height: 80px;
            resize: vertical;
        }

        .field-value input:focus,
        .field-value textarea:focus {
            outline: none;
            border-color: #0e639c;
        }

        .field-actions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .field-actions button {
            padding: 6px 10px;
            background: #3e3e42;
            color: #d4d4d4;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .field-actions button:hover {
            background: #505050;
        }

        .field-actions button.danger {
            background: #c74440;
            color: white;
        }

        .field-actions button.danger:hover {
            background: #e51400;
        }

        .add-field-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            color: #888;
            border: 2px dashed #3e3e42;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .add-field-btn:hover {
            background: #2d2d30;
            color: #d4d4d4;
            border-color: #0e639c;
        }

        .nested-container {
            margin-top: 10px;
        }

        .empty-creator {
            text-align: center;
            padding: 80px 20px;
            color: #888;
        }

        .empty-creator h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #d4d4d4;
        }

        .empty-creator p {
            margin-bottom: 25px;
            font-size: 16px;
        }

        .empty-creator button {
            padding: 15px 30px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
            margin: 0 5px;
        }

        .empty-creator button:hover {
            background: #1177bb;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>JSON Files</h2>
                <button class="add-json-btn" onclick="showAddModal()">+ Add JSON</button>
            </div>
            <div class="json-list" id="jsonList"></div>
        </div>

        <div class="main-content">
            <div class="toolbar">
                <div class="view-toggle">
                    <button class="view-btn active" id="rawViewBtn" onclick="switchView('raw')">üìÑ Raw View</button>
                    <button class="view-btn" id="mindmapViewBtn" onclick="switchView('mindmap')">üó∫Ô∏è Mind Map</button>
                    <button class="view-btn" id="creatorViewBtn" onclick="switchView('creator')">‚úèÔ∏è Creator</button>
                </div>
                <button id="expandBtn" onclick="expandAll()">Expand All</button>
                <button id="collapseBtn" onclick="collapseAll()">Collapse All</button>
            </div>
            <div class="viewer-container">
                <div class="json-viewer" id="viewer">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m9 16v-2H6v2h9m3-4v-2H6v2h12z" />
                        </svg>
                        <h3>No JSON loaded</h3>
                        <p>Add a JSON file to get started</p>
                    </div>
                </div>
                <div class="mindmap-viewer" id="mindmapViewer">
                    <canvas id="mindmapCanvas"></canvas>
                    <div class="mindmap-controls">
                        <button onclick="zoomIn()">üîç +</button>
                        <button onclick="zoomOut()">üîç -</button>
                        <button onclick="resetZoom()">‚Ü∫ Reset</button>
                        <button onclick="expandAllNodes()">‚äï Expand All</button>
                        <button onclick="collapseAllNodes()">‚äñ Collapse All</button>
                    </div>
                    <div class="mindmap-info">
                        üí° Click nodes to expand/collapse ‚Ä¢ Drag nodes to reposition ‚Ä¢ Scroll to zoom ‚Ä¢ Drag canvas to
                        pan
                    </div>
                </div>
                <div class="creator-viewer" id="creatorViewer">
                    <div class="creator-container">
                        <div class="creator-header">
                            <h2>JSON Creator</h2>
                            <div class="creator-actions">
                                <button class="secondary" onclick="clearCreator()">Clear</button>
                                <button onclick="saveCreatedJSON()">Save JSON</button>
                            </div>
                        </div>
                        <div class="json-builder" id="jsonBuilder"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-content">
            <h3>Add JSON</h3>
            <input type="file" id="fileInput" accept=".json" onchange="handleFileUpload(event)">
            <label for="fileInput" style="display: block; margin-bottom: 15px;">
                <button class="btn-secondary" onclick="document.getElementById('fileInput').click()"
                    style="width: 100%;">
                    Upload JSON File
                </button>
            </label>
            <p style="margin-bottom: 10px; color: #888; text-align: center;">OR</p>
            <textarea id="jsonInput" placeholder="Paste your JSON here..."></textarea>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="hideAddModal()">Cancel</button>
                <button class="btn-primary" onclick="addJSON()">Add JSON</button>
            </div>
        </div>
    </div>

    <script>
        let jsons = [];
        let currentIndex = -1;
        let currentView = 'raw';

        // Mindmap variables
        let canvas, ctx;
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let nodes = new Map();
        let collapsedNodes = new Set();
        let draggedNode = null;
        let nodePositions = new Map();

        // Creator variables
        let creatorData = [];
        let nodeIdCounter = 0;

        function initCanvas() {
            canvas = document.getElementById('mindmapCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            canvas.addEventListener('mousedown', startDrag);
            canvas.addEventListener('mousemove', drag);
            canvas.addEventListener('mouseup', endDrag);
            canvas.addEventListener('mouseleave', endDrag);
            canvas.addEventListener('wheel', handleWheel);
        }

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            if (currentView === 'mindmap' && currentIndex !== -1) {
                drawMindmap();
            }
        }

        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: (e.clientX - rect.left - offsetX) / scale,
                y: (e.clientY - rect.top - offsetY) / scale
            };
        }

        function startDrag(e) {
            const mousePos = getMousePos(e);

            // Check if clicking on a node
            for (let [path, node] of nodes) {
                if (mousePos.x >= node.x - node.width / 2 &&
                    mousePos.x <= node.x + node.width / 2 &&
                    mousePos.y >= node.y - node.height / 2 &&
                    mousePos.y <= node.y + node.height / 2) {

                    // Check if clicking on toggle button
                    if (node.hasChildren &&
                        mousePos.x >= node.x + node.width / 2 - 25 &&
                        mousePos.x <= node.x + node.width / 2 - 5) {
                        toggleNode(path);
                        return;
                    }

                    // Start dragging node
                    draggedNode = {
                        path: path,
                        offsetX: mousePos.x - node.x,
                        offsetY: mousePos.y - node.y
                    };
                    canvas.classList.add('node-dragging');
                    return;
                }
            }

            // Start dragging canvas
            isDragging = true;
            dragStartX = e.clientX - offsetX;
            dragStartY = e.clientY - offsetY;
        }

        function drag(e) {
            if (draggedNode) {
                const mousePos = getMousePos(e);
                const node = nodes.get(draggedNode.path);
                if (node) {
                    node.x = mousePos.x - draggedNode.offsetX;
                    node.y = mousePos.y - draggedNode.offsetY;
                    nodePositions.set(draggedNode.path, { x: node.x, y: node.y });
                    drawMindmap();
                }
            } else if (isDragging) {
                offsetX = e.clientX - dragStartX;
                offsetY = e.clientY - dragStartY;
                drawMindmap();
            }
        }

        function endDrag() {
            isDragging = false;
            draggedNode = null;
            canvas.classList.remove('node-dragging');
        }

        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = scale * delta;
            if (newScale >= 0.1 && newScale <= 3) {
                scale = newScale;
                drawMindmap();
            }
        }

        function toggleNode(path) {
            if (collapsedNodes.has(path)) {
                collapsedNodes.delete(path);
            } else {
                collapsedNodes.add(path);
            }
            drawMindmap();
        }

        function zoomIn() {
            if (scale < 3) {
                scale *= 1.2;
                drawMindmap();
            }
        }

        function zoomOut() {
            if (scale > 0.1) {
                scale *= 0.8;
                drawMindmap();
            }
        }

        function resetZoom() {
            scale = 1;
            offsetX = canvas.width / 2;
            offsetY = 100;
            collapsedNodes.clear();
            nodePositions.clear();
            drawMindmap();
        }

        function expandAllNodes() {
            collapsedNodes.clear();
            drawMindmap();
        }

        function collapseAllNodes() {
            for (let [path, node] of nodes) {
                if (node.hasChildren) {
                    collapsedNodes.add(path);
                }
            }
            drawMindmap();
        }

        function drawMindmap() {
            if (currentIndex === -1) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            nodes.clear();

            const data = jsons[currentIndex].data;
            const startX = 0;
            const startY = 0;

            // First pass: calculate positions
            calculateNodePosition(data, startX, startY, '', 0, null);

            // Second pass: draw connections
            ctx.save();
            ctx.translate(offsetX, offsetY);
            ctx.scale(scale, scale);

            for (let [path, node] of nodes) {
                if (node.parent) {
                    const parent = nodes.get(node.parent);
                    if (parent) {
                        ctx.strokeStyle = '#505050';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(parent.x, parent.y + parent.height / 2);
                        ctx.lineTo(node.x, node.y - node.height / 2);
                        ctx.stroke();
                    }
                }
            }

            ctx.restore();

            // Third pass: draw nodes
            for (let [path, node] of nodes) {
                drawNode(node);
            }
        }

        function calculateNodePosition(obj, x, y, key, level, parentPath) {
            const isRoot = level === 0;
            const path = parentPath ? `${parentPath}.${key}` : (key || 'root');
            const isCollapsed = collapsedNodes.has(path);

            // Use stored position if available
            const storedPos = nodePositions.get(path);
            if (storedPos) {
                x = storedPos.x;
                y = storedPos.y;
            }

            const displayKey = isRoot ? jsons[currentIndex].name : key;

            let nodeColor, textColor, borderColor;
            if (isRoot) {
                nodeColor = '#0e639c';
                textColor = '#ffffff';
                borderColor = '#1177bb';
            } else if (typeof obj === 'object' && obj !== null) {
                nodeColor = '#2d2d30';
                textColor = '#9cdcfe';
                borderColor = '#3e3e42';
            } else {
                nodeColor = '#1e1e1e';
                textColor = '#d4d4d4';
                borderColor = '#3e3e42';
            }

            ctx.font = isRoot ? 'bold 16px Segoe UI' : '14px Segoe UI';
            const text = displayKey + (typeof obj === 'object' && obj !== null ? '' : ': ' + JSON.stringify(obj));
            const maxWidth = 200;
            const textWidth = Math.min(ctx.measureText(text).width, maxWidth);
            const padding = 12;
            const nodeWidth = textWidth + padding * 2 + (typeof obj === 'object' && obj !== null && (Array.isArray(obj) ? obj.length > 0 : Object.keys(obj).length > 0) ? 20 : 0);
            const nodeHeight = 36;

            const hasChildren = typeof obj === 'object' && obj !== null &&
                (Array.isArray(obj) ? obj.length > 0 : Object.keys(obj).length > 0);

            nodes.set(path, {
                x, y,
                width: nodeWidth,
                height: nodeHeight,
                text,
                nodeColor,
                textColor,
                borderColor,
                hasChildren,
                isRoot,
                parent: parentPath
            });

            // Calculate children positions if not collapsed
            if (hasChildren && !isCollapsed) {
                const entries = Array.isArray(obj) ?
                    obj.map((v, i) => [i, v]) :
                    Object.entries(obj);

                const childSpacing = 150;
                const verticalSpacing = 120;
                const totalWidth = entries.length * childSpacing;
                const startChildX = x - totalWidth / 2 + childSpacing / 2;
                const childY = y + verticalSpacing;

                entries.forEach(([k, v], i) => {
                    const childX = startChildX + i * childSpacing;
                    calculateNodePosition(v, childX, childY, k, level + 1, path);
                });
            }
        }

        function drawNode(node) {
            ctx.save();
            ctx.translate(offsetX, offsetY);
            ctx.scale(scale, scale);

            // Draw node background
            ctx.fillStyle = node.nodeColor;
            ctx.strokeStyle = node.borderColor;
            ctx.lineWidth = 2;
            roundRect(ctx, node.x - node.width / 2, node.y - node.height / 2, node.width, node.height, 6);
            ctx.fill();
            ctx.stroke();

            // Draw text
            ctx.fillStyle = node.textColor;
            ctx.font = node.isRoot ? 'bold 16px Segoe UI' : '14px Segoe UI';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            const displayText = node.text.length > 30 ? node.text.substring(0, 27) + '...' : node.text;
            ctx.fillText(displayText, node.x - node.width / 2 + 12, node.y);

            // Draw expand/collapse indicator
            if (node.hasChildren) {
                const path = Array.from(nodes.entries()).find(([p, n]) => n === node)?.[0];
                const isCollapsed = collapsedNodes.has(path);

                ctx.fillStyle = node.textColor;
                ctx.font = '14px Segoe UI';
                ctx.textAlign = 'center';
                ctx.fillText(isCollapsed ? '‚ñ∂' : '‚ñº', node.x + node.width / 2 - 12, node.y);
            }

            ctx.restore();
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        function switchView(view) {
            currentView = view;
            const rawBtn = document.getElementById('rawViewBtn');
            const mindmapBtn = document.getElementById('mindmapViewBtn');
            const creatorBtn = document.getElementById('creatorViewBtn');
            const viewer = document.getElementById('viewer');
            const mindmapViewer = document.getElementById('mindmapViewer');
            const creatorViewer = document.getElementById('creatorViewer');
            const expandBtn = document.getElementById('expandBtn');
            const collapseBtn = document.getElementById('collapseBtn');

            // Reset all
            rawBtn.classList.remove('active');
            mindmapBtn.classList.remove('active');
            creatorBtn.classList.remove('active');
            viewer.classList.add('hidden');
            mindmapViewer.classList.remove('active');
            creatorViewer.classList.remove('active');

            if (view === 'raw') {
                rawBtn.classList.add('active');
                viewer.classList.remove('hidden');
                expandBtn.style.display = 'block';
                collapseBtn.style.display = 'block';
            } else if (view === 'mindmap') {
                mindmapBtn.classList.add('active');
                mindmapViewer.classList.add('active');
                expandBtn.style.display = 'none';
                collapseBtn.style.display = 'none';
                setTimeout(() => {
                    resizeCanvas();
                    if (nodePositions.size === 0) {
                        resetZoom();
                    } else {
                        drawMindmap();
                    }
                }, 50);
            } else if (view === 'creator') {
                creatorBtn.classList.add('active');
                creatorViewer.classList.add('active');
                expandBtn.style.display = 'none';
                collapseBtn.style.display = 'none';
                renderCreator();
            }
        }

        function showAddModal() {
            document.getElementById('addModal').classList.add('show');
            document.getElementById('jsonInput').value = '';
        }

        function hideAddModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    document.getElementById('jsonInput').value = event.target.result;
                };
                reader.readAsText(file);
            }
        }

        function addJSON() {
            const input = document.getElementById('jsonInput').value.trim();
            if (!input) return;

            try {
                const parsed = JSON.parse(input);
                const name = prompt('Enter a name for this JSON:', `JSON ${jsons.length + 1}`);
                if (!name) return;

                jsons.push({ name, data: parsed });
                renderList();
                selectJSON(jsons.length - 1);
                hideAddModal();
            } catch (e) {
                alert('Invalid JSON: ' + e.message);
            }
        }

        function deleteJSON(index, e) {
            e.stopPropagation();
            if (confirm('Delete this JSON?')) {
                jsons.splice(index, 1);
                if (currentIndex === index) {
                    currentIndex = -1;
                    document.getElementById('viewer').innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 9h5.5L13 3.5V9M6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m9 16v-2H6v2h9m3-4v-2H6v2h12z"/></svg><h3>No JSON loaded</h3><p>Add a JSON file to get started</p></div>';
                } else if (currentIndex > index) {
                    currentIndex--;
                }
                renderList();
            }
        }

        function selectJSON(index) {
            currentIndex = index;
            collapsedNodes.clear();
            nodePositions.clear();
            renderList();
            renderJSON(jsons[index].data);
            if (currentView === 'mindmap') {
                setTimeout(() => {
                    resetZoom();
                }, 100);
            }
        }

        function renderList() {
            const list = document.getElementById('jsonList');
            list.innerHTML = jsons.map((json, i) => `
                <div class="json-item ${i === currentIndex ? 'active' : ''}" onclick="selectJSON(${i})">
                    <span class="json-item-name">${json.name}</span>
                    <button class="delete-btn" onclick="deleteJSON(${i}, event)">√ó</button>
                </div>
            `).join('');
        }

        function renderJSON(data) {
            const viewer = document.getElementById('viewer');
            viewer.innerHTML = '';
            viewer.appendChild(createTreeNode(data, '', true));
        }

        function createTreeNode(obj, key, isRoot = false) {
            const container = document.createElement('div');

            if (typeof obj === 'object' && obj !== null) {
                const isArray = Array.isArray(obj);
                const isEmpty = isArray ? obj.length === 0 : Object.keys(obj).length === 0;

                const item = document.createElement('div');
                item.className = 'tree-item';

                if (!isEmpty) {
                    const toggle = document.createElement('span');
                    toggle.className = 'toggle';
                    toggle.textContent = '‚ñº';
                    toggle.onclick = function (e) {
                        e.stopPropagation();
                        container.classList.toggle('collapsed');
                        toggle.textContent = container.classList.contains('collapsed') ? '‚ñ∂' : '‚ñº';
                    };
                    item.appendChild(toggle);
                } else {
                    const spacer = document.createElement('span');
                    spacer.className = 'toggle';
                    item.appendChild(spacer);
                }

                if (key && !isRoot) {
                    const keySpan = document.createElement('span');
                    keySpan.className = 'key';
                    keySpan.textContent = `"${key}": `;
                    item.appendChild(keySpan);
                }

                const bracket = document.createElement('span');
                bracket.className = 'bracket';
                bracket.textContent = isArray ? '[' : '{';
                item.appendChild(bracket);

                if (isEmpty) {
                    const closeBracket = document.createElement('span');
                    closeBracket.className = 'bracket';
                    closeBracket.textContent = isArray ? ']' : '}';
                    item.appendChild(closeBracket);
                }

                container.appendChild(item);

                if (!isEmpty) {
                    const childContainer = document.createElement('div');
                    childContainer.className = 'tree-node';

                    const entries = isArray ? obj.map((v, i) => [i, v]) : Object.entries(obj);
                    entries.forEach(([k, v]) => {
                        childContainer.appendChild(createTreeNode(v, k));
                    });

                    container.appendChild(childContainer);

                    const closingItem = document.createElement('div');
                    closingItem.className = 'tree-item';
                    const spacer = document.createElement('span');
                    spacer.className = 'toggle';
                    closingItem.appendChild(spacer);
                    const closeBracket = document.createElement('span');
                    closeBracket.className = 'bracket';
                    closeBracket.textContent = isArray ? ']' : '}';
                    closingItem.appendChild(closeBracket);
                    container.appendChild(closingItem);
                }
            } else {
                const item = document.createElement('div');
                item.className = 'tree-item';

                const spacer = document.createElement('span');
                spacer.className = 'toggle';
                item.appendChild(spacer);

                if (key !== '') {
                    const keySpan = document.createElement('span');
                    keySpan.className = 'key';
                    keySpan.textContent = `"${key}": `;
                    item.appendChild(keySpan);
                }

                const valueSpan = document.createElement('span');
                if (typeof obj === 'string') {
                    valueSpan.className = 'string';
                    valueSpan.textContent = `"${obj}"`;
                } else if (typeof obj === 'number') {
                    valueSpan.className = 'number';
                    valueSpan.textContent = obj;
                } else if (typeof obj === 'boolean') {
                    valueSpan.className = 'boolean';
                    valueSpan.textContent = obj;
                } else if (obj === null) {
                    valueSpan.className = 'null';
                    valueSpan.textContent = 'null';
                }
                item.appendChild(valueSpan);
                container.appendChild(item);
            }

            return container;
        }

        function expandAll() {
            document.querySelectorAll('.collapsed').forEach(el => {
                el.classList.remove('collapsed');
                const toggle = el.querySelector('.toggle');
                if (toggle) toggle.textContent = '‚ñº';
            });
        }

        function collapseAll() {
            document.querySelectorAll('.tree-item').forEach(item => {
                const toggle = item.querySelector('.toggle');
                if (toggle && toggle.textContent === '‚ñº') {
                    item.parentElement.classList.add('collapsed');
                    toggle.textContent = '‚ñ∂';
                }
            });
        }

        // Sample data for demonstration
        const sampleData = {
            name: "Sample JSON",
            data: {
                "user": {
                    "id": 12345,
                    "name": "John Doe",
                    "email": "john@example.com",
                    "profile": {
                        "age": 30,
                        "location": {
                            "city": "New York",
                            "country": "USA",
                            "coordinates": {
                                "lat": 40.7128,
                                "lng": -74.0060
                            }
                        },
                        "interests": ["coding", "music", "travel"]
                    }
                },
                "settings": {
                    "theme": "dark",
                    "notifications": true,
                    "privacy": {
                        "profileVisible": true,
                        "searchable": false
                    }
                },
                "projects": [
                    {
                        "id": 1,
                        "name": "Project Alpha",
                        "status": "active",
                        "tasks": [
                            { "id": 101, "title": "Design UI", "completed": true },
                            { "id": 102, "title": "Backend API", "completed": false }
                        ]
                    },
                    {
                        "id": 2,
                        "name": "Project Beta",
                        "status": "planning"
                    }
                ]
            }
        };

        // Initialize
        initCanvas();
        jsons.push(sampleData);
        renderList();
        selectJSON(0);

        // Creator functions
        function renderCreator() {
            const builder = document.getElementById('jsonBuilder');

            if (!creatorData || creatorData.length === 0) {
                builder.innerHTML = `
                    <div class="empty-creator">
                        <h3>Create Your JSON</h3>
                        <p>Start simple or go deep - it's up to you!</p>
                        <button onclick="startCreator()">Start Building</button>
                    </div>
                `;
                return;
            }

            builder.innerHTML = '';
            creatorData.forEach((field, index) => {
                renderField(field, builder, index, [index]);
            });

            const addBtn = document.createElement('button');
            addBtn.className = 'add-field-btn';
            addBtn.textContent = '+ Add Field';
            addBtn.onclick = () => addField();
            builder.appendChild(addBtn);
        }

        function startCreator() {
            creatorData = [];
            addField();
        }

        function clearCreator() {
            if (confirm('Clear all fields?')) {
                creatorData = [];
                renderCreator();
            }
        }

        function addField(parentPath = null) {
            const field = {
                id: nodeIdCounter++,
                key: '',
                type: 'string',
                value: '',
                children: null
            };

            if (parentPath === null) {
                creatorData.push(field);
            } else {
                let parent = getFieldByPath(parentPath);
                if (!parent.children) parent.children = [];
                parent.children.push(field);
            }

            renderCreator();
        }

        function getFieldByPath(path) {
            let field = creatorData[path[0]];
            for (let i = 1; i < path.length; i++) {
                field = field.children[path[i]];
            }
            return field;
        }

        function renderField(field, container, index, path) {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'field-item' + (path.length > 1 ? ' nested' : '');

            // Key input
            const keyDiv = document.createElement('div');
            keyDiv.className = 'field-key';
            const keyInput = document.createElement('input');
            keyInput.type = 'text';
            keyInput.placeholder = 'Key name';
            keyInput.value = field.key;
            keyInput.oninput = (e) => {
                field.key = e.target.value;
            };
            keyDiv.appendChild(keyInput);
            fieldDiv.appendChild(keyDiv);

            // Type selector
            const typeDiv = document.createElement('div');
            typeDiv.className = 'field-type';
            const typeSelect = document.createElement('select');
            typeSelect.innerHTML = `
                <option value="string">String</option>
                <option value="number">Number</option>
                <option value="boolean">Boolean</option>
                <option value="null">Null</option>
                <option value="object">Object</option>
                <option value="array">Array</option>
            `;
            typeSelect.value = field.type;
            typeSelect.onchange = (e) => {
                field.type = e.target.value;
                if (e.target.value === 'object' || e.target.value === 'array') {
                    if (!field.children) field.children = [];
                    field.value = null;
                } else {
                    field.children = null;
                    field.value = getDefaultValue(e.target.value);
                }
                renderCreator();
            };
            typeDiv.appendChild(typeSelect);
            fieldDiv.appendChild(typeDiv);

            // Value input (only for primitives)
            if (field.type !== 'object' && field.type !== 'array') {
                const valueDiv = document.createElement('div');
                valueDiv.className = 'field-value';

                if (field.type === 'string') {
                    const input = document.createElement('textarea');
                    input.placeholder = 'Enter value...';
                    input.value = field.value || '';
                    input.oninput = (e) => field.value = e.target.value;
                    valueDiv.appendChild(input);
                } else if (field.type === 'number') {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.placeholder = '0';
                    input.value = field.value || 0;
                    input.oninput = (e) => field.value = parseFloat(e.target.value) || 0;
                    valueDiv.appendChild(input);
                } else if (field.type === 'boolean') {
                    const select = document.createElement('select');
                    select.innerHTML = '<option value="true">true</option><option value="false">false</option>';
                    select.value = field.value ? 'true' : 'false';
                    select.onchange = (e) => field.value = e.target.value === 'true';
                    valueDiv.appendChild(select);
                } else if (field.type === 'null') {
                    const span = document.createElement('span');
                    span.textContent = 'null';
                    span.style.color = '#569cd6';
                    span.style.padding = '8px 12px';
                    valueDiv.appendChild(span);
                }

                fieldDiv.appendChild(valueDiv);
            }

            // Actions
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'field-actions';

            if (field.type === 'object' || field.type === 'array') {
                const nestBtn = document.createElement('button');
                nestBtn.textContent = '+ Nest';
                nestBtn.onclick = () => addField(path);
                actionsDiv.appendChild(nestBtn);
            }

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'danger';
            deleteBtn.textContent = '‚úï';
            deleteBtn.onclick = () => deleteField(path);
            actionsDiv.appendChild(deleteBtn);

            fieldDiv.appendChild(actionsDiv);
            container.appendChild(fieldDiv);

            // Render nested children
            if (field.children && field.children.length > 0) {
                const nestedContainer = document.createElement('div');
                nestedContainer.className = 'nested-container';
                field.children.forEach((child, idx) => {
                    renderField(child, nestedContainer, idx, [...path, idx]);
                });
                container.appendChild(nestedContainer);
            }
        }

        function deleteField(path) {
            if (path.length === 1) {
                creatorData.splice(path[0], 1);
            } else {
                let parent = creatorData[path[0]];
                for (let i = 1; i < path.length - 1; i++) {
                    parent = parent.children[path[i]];
                }
                parent.children.splice(path[path.length - 1], 1);
            }
            renderCreator();
        }

        function getDefaultValue(type) {
            switch (type) {
                case 'string': return '';
                case 'number': return 0;
                case 'boolean': return false;
                case 'null': return null;
                default: return null;
            }
        }

        function saveCreatedJSON() {
            if (!creatorData || creatorData.length === 0) {
                alert('Add some fields first!');
                return;
            }

            const json = buildJSONFromFields(creatorData);
            const name = prompt('Name your JSON:', `Created JSON ${jsons.length + 1}`);
            if (!name) return;

            jsons.push({ name, data: json });
            renderList();
            selectJSON(jsons.length - 1);

            if (confirm('JSON saved! Start fresh?')) {
                creatorData = [];
                renderCreator();
            }
        }

        function buildJSONFromFields(fields) {
            const result = {};

            fields.forEach(field => {
                if (!field.key) return;

                if (field.type === 'object') {
                    result[field.key] = field.children ? buildJSONFromFields(field.children) : {};
                } else if (field.type === 'array') {
                    result[field.key] = field.children ? field.children.map(child => {
                        if (child.type === 'object') {
                            return child.children ? buildJSONFromFields(child.children) : {};
                        } else if (child.type === 'array') {
                            return child.children ? buildArrayFromFields(child.children) : [];
                        } else {
                            return child.value;
                        }
                    }) : [];
                } else {
                    result[field.key] = field.value;
                }
            });

            return result;
        }

        function buildArrayFromFields(fields) {
            return fields.map(field => {
                if (field.type === 'object') {
                    return field.children ? buildJSONFromFields(field.children) : {};
                } else if (field.type === 'array') {
                    return field.children ? buildArrayFromFields(field.children) : [];
                } else {
                    return field.value;
                }
            });
        }
    </script>
</body>

</html> 0) return;

let parent = creatorData;
for (let i = 0; i < path.length - 1; i++) { parent=parent.children[path[i]]; } parent.children.splice(path[path.length -
    1], 1); renderCreator(); } function saveCreatedJSON() { if (!creatorData) { alert('No data to save!'); return; }
    const json=buildJSON(creatorData); const name=prompt('Enter a name for this JSON:', `Created JSON ${jsons.length +
    1}`); if (!name) return; jsons.push({ name, data: json }); renderList(); selectJSON(jsons.length - 1); // Ask if
    they want to clear creator if (confirm('JSON saved! Clear the creator?')) { clearCreator(); } } function
    buildJSON(node) { if (node.type==='object' ) { const obj={}; node.children.forEach(child=> {
    obj[child.key] = buildJSON(child);
    });
    return obj;
    } else if (node.type === 'array') {
    return node.children.map(child => buildJSON(child));
    } else {
    return node.value;
    }
    }
    </script>
    </body>

    </html>